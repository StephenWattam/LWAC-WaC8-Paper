\documentclass[xcolor=x11names,compress]{beamer}

% -----------------------------------------------------------------------------------------
% The bit you should be interested in
%
% \usetheme[infolabcolours,num,forcecurve]{SmartSerif}
% \usetheme[bgcurve]{SmartSerif}
% \usetheme[num]{SmartSerif}
% \usetheme[bannerline=red]{SmartSerif}
% \usetheme[bannerbg=black]{SmartSerif}
% \usetheme[]{SmartSerif}
% 

\usetheme[draft,nocurve,num]{SmartSerif}


% -----------------------------------------------------------------------------------------
% Other things for the sample
\usepackage{hyperref}

\usepackage{graphicx}
\graphicspath{ {./images/} }


% -----------------------------------------------------------------------------------------

\title{
    \includegraphics[scale=0.3]{logo_large.png}\\
    LWAC: Longitudinal Web as Corpus\vspace{15pt}}
\author{Stephen Wattam,\
Paul Rayson,\
Damon Berridge}
\institute[2013]{Lancaster University}
\date{\tiny July 22, 2013}

\begin{document}

\maketitle

% \section[Outline]{}
\frame{\tableofcontents}

% =========================================================================================
%  About longitudinal sampling---why do it?
\section{Rationale}
% ----------------------------------------------------------------------------
\subsection{Rationale}


\frame{\frametitle{WaC for Language Change}
    Many ways of measuring change online:

    \vspace{10pt}
    \begin{itemize}
        \item Crawlers/Revisiting
            \vspace{5pt}
        \item Diachronic corpora
            \vspace{5pt}
        \item Monitor Corpora
            \vspace{5pt}
        \item Subsampling supercorpora
            \vspace{5pt}
        \item Feed corpora
    \end{itemize}  

}





\frame{\frametitle{Issues}
    \begin{itemize}
        \item Irregular visits to pages \\
            {\small ``...visiting each website again in the next crawl anticipating for new content is cost-inefficient.''}
        \vspace{10pt}
        \item Manual supervision required
        \vspace{10pt}
        \item Lack of detail on network properties
        \vspace{10pt}
        \item Non-versioned corpus formats
    \end{itemize}  

    % \note{\begin{itemize}
    %         \item
    % \end{itemize}}
}




\frame{\frametitle{Wish List}
    \begin{itemize}
        \item Reliable, regular sampling strategy
        \vspace{10pt}
        \item Set and forget operation
        \vspace{10pt}
        \item Vertical and horizontal comparability
        \vspace{10pt}
        \item Rigorous \& exhaustive data collection
        \vspace{10pt}
        \item Integrated corpus format
    \end{itemize}  

    % \note{\begin{itemize}
    %         \item
    % \end{itemize}}
}


% ----------------------------------------------------------------------------
\subsection{Sample Design}


\frame{\frametitle{Cohort Sampling}
    \begin{itemize}
        \item Common longitudinal design
    \vspace{10pt}
        \item Used elsewhere to disambiguate long- from short-term effects
            % BHPS, other national longitudinal studies
    \vspace{10pt}
        \item Fits with open-source, URL-based corpus model
    \vspace{10pt}
\end{itemize}
}


\frame{\frametitle{Cohort Sampling}
    \begin{center}
        \includegraphics<1>{samples.eps}
        \includegraphics<2>{samples_crawl.eps}
        \includegraphics<3>{samples_cohort.eps}
    \end{center}


    \note{\begin{itemize}
            \item Mention regularity of samples
            \item Mention the horizontal/vertical constraints being rigorous and reliable
    \end{itemize}}
}
    %     \item Exposes technical and linguistic change over time
    % \end{itemize}    


\frame{\frametitle{Uses}
    Observing network properties over time:
    \vspace{10pt}
    \begin{itemize}
        \item Link rot/document attrition
        \item Latency
        \item Server properties, headers, protocol support
    \end{itemize}    
    
    \vspace{10pt}
    
    Observing user's experience of common websites/links:
    \vspace{10pt}
    \begin{itemize}
        \item Editorial policy
        \item Page revisions
        \item ``live'' page content
    \end{itemize}    
}




% =========================================================================================
\section{LWAC}
\subsection{Design}

\frame{\frametitle{LWAC}
\begin{itemize}
    \item Download/Sampling tool for longitudinal use
        \vspace{5pt}
    \item Suitable for long- or short-term samples
        \vspace{5pt}
    \item Reliable
        \vspace{5pt}
    \item Scalable
        \vspace{5pt}
    \item Hard to detect
        \vspace{5pt}
    \item Records network and content related variables
\end{itemize}    
}


\subsection{Properties}



\frame{\frametitle{Data}
    \begin{itemize}
        % \item Each sample is temporally homogenous
        % \vspace{5pt}
        \item Vertical and horizontal comparability of samples
        \vspace{5pt}
        \item Configuration, network properties and data recorded for later use
        \vspace{5pt}
        \item `No data left behind' policy: $\approx 120$ variables stored on each request
        \vspace{5pt}
        \item Format, size filters to exclude unwanted data
        \vspace{5pt}
        \item Charset normalisation
    \end{itemize}  

    % \note{\begin{itemize}
    %         \item
    % \end{itemize}}
}
% 
% \subsection{Data Storage}
% \frame{\frametitle{Data Storage}
% \begin{itemize}
%     \item MySQL or SQLite3 for links
%     \item Versioned `NoSQL' for data
%     \item Configurable serialisation format
%     \item Accessible by Server, Sample or Data-level features
% \end{itemize}    
% }
% 

\frame{\frametitle{Import/Export}
\begin{itemize}
    \item Import URL lists
        \vspace{10pt}
    \item Export to CSV, XML or arbitrary templates
        \vspace{10pt}
    \item Export using filters and data normalisation scripts
        \vspace{10pt}
    \item Live export supported
\end{itemize}    
}




\frame{\frametitle{User Model}

    LWAC can imitate real users or crawlers:
    \vspace{10pt}
    \begin{itemize}
        \item Realistic redirect handling
        \vspace{10pt}
        \item Timeouts at all stages of URL lookup
        \vspace{10pt}
        \item Spoofing of user-agent
        \vspace{10pt}
        \item Realistic request headers, cookie use
    \end{itemize}  

    % \note{\begin{itemize}
    %         \item
    % \end{itemize}}
}





\frame{\frametitle{Reliability}
    \begin{itemize}
        \item No skew on sampling intervals
        \vspace{10pt}
        \item Data security across crashes/restarts (atomicity)
        \vspace{10pt}
        \item Error reporting, detailed logging
        \vspace{10pt}
        \item Stability for long-term runs
    \end{itemize}  

    % \note{\begin{itemize}
    %         \item
    % \end{itemize}}
}




% -----------------------------------------------------------------------------------------
%  About the form LWAC takes
% \section{Implementation}
\subsection{Implementation}

\frame{\frametitle{Overview}
    \begin{itemize}
        \item UNIX-model tool set% (cross-platform?)
            \vspace{10pt}
        \item Written in Ruby using cURL
            \vspace{10pt}
        \item Distributed client-server design
            \vspace{10pt}
        \item Central control of sampling policy
    \end{itemize}    
    \vspace{10pt}


 
    \begin{figure}
        \makebox[\textwidth][c]{\includegraphics[width=\textwidth]{arch.eps}}%
        \label{fig:dates}
    \end{figure}

}


\subsection{Workflow}
\frame{\frametitle{Basic Workflow}
      \begin{columns}
            \begin{column}{.7\linewidth}
            \begin{enumerate}
                \item<1-> Find links of interest ([Web]BootCaT)
                \item<2-> Import links (\texttt{lwac import})
                \item<3-> Set up clients (\texttt{lwac client})
                \item<4-> Run server (\texttt{lwac server})
                \item<5-> Drink coffee (RFC 2324)
                \item<6-> Export data (\texttt{lwac export})
                \item<7-> Do science
            \end{enumerate}    
            \end{column}
            \begin{column}{.25\linewidth}
                \includegraphics[scale=0.1]<5->{coffee.jpg}
            \end{column}
      \end{columns}

    
    
     
     \begin{figure}
         \includegraphics[width=\textwidth]<1>{arch.eps}
         \includegraphics[width=\textwidth]<2>{arch_import.eps}
         \includegraphics[width=\textwidth]<3>{arch_client.eps}
         \includegraphics[width=\textwidth]<4>{arch_server.eps}
         \includegraphics[width=\textwidth]<5>{arch_sample.eps}
         \includegraphics[width=\textwidth]<6>{arch_import.eps}
         \includegraphics[width=\textwidth]<7->{arch.eps}
         \label{fig:dates}
     \end{figure}


    \note{\begin{itemize}
            \item Step through workflow
            \item You may wish to use a process monitor on the client and server
            \item You can export before the server is done (and even delete old samples from the disk)
            \item RFC2324 is HTCPCP: the Hyper Text Coffee Pot Control Protocol
    \end{itemize}}
}


% \frame{\frametitle{Tools}
%     \begin{itemize}
%         \item \textbf{Import}---Imports links into the database
%         \item \textbf{Server}---Controls sampling policy and data storage
%         \item \textbf{Client}---Makes requests to the web, normalises data
%         \item \textbf{Export}---Extracts metadata and text from the server's corpus directory
%     \end{itemize}    
% 
%     \note{\begin{itemize}
%             \item Go through these, p'raps?
%     \end{itemize}}
% }



% 
% 
% \frame{\frametitle{Server}
% \begin{itemize}
%     \item Waits for clients to connect 
%         \vspace{5pt}
%     \item Manages all data
%         \vspace{5pt}
%     \item Ensures atomic data access
%         \vspace{5pt}
%     \item Controls sampling policy centrally
%         \vspace{5pt}
%     \item Logs everything in obscene detail
% \end{itemize}
% }
% 
% \frame{\frametitle{Client}
% \begin{itemize}
%     \item Receives batches of work from servers
%         \vspace{10pt}
%     \item Highly parallel downloads (using cURL)
%         \vspace{10pt}
%     \item Able to normalise character set, respond to redirects
%         \vspace{10pt}
%     \item Configured by server on-the-fly
%         \vspace{10pt}
%     \item Able to run on low powered machines such as VMs
% \end{itemize}    
% }
% 






% =========================================================================================
\section{Performance \& Limits}
\subsection*{Performance}
\frame{\frametitle{Performance}
Dependent on:
\vspace{10pt}
\begin{itemize}
    \item Number of clients
    \vspace{10pt}
    \item Number of connections per client
    \vspace{10pt}
    \item Client-server network speeds
    \vspace{10pt}
    \item Latency/speed of DNS, web servers
\end{itemize}    
}




% -----------------------------------------------------------------------------------------
\subsection{Throughput}

\frame{\frametitle{Throughput (1 client)}
    \includegraphics[width=\textwidth]{parallelrate}
}



\frame{\frametitle{Throughput (n clients)}
    \includegraphics[width=\textwidth]{clientrate}
}


\frame{\frametitle{Throughput (real-world)}
Corpus:
\begin{itemize}
    \item BootCaT-derived URL List
    \item 228k URLs: 4600 requests, 50 links/call
\end{itemize}    
    \vspace{10pt}

System:
\begin{itemize}
    \item 3 clients, 400 connections/client
\end{itemize}    

    \vspace{10pt}
Throughput:
\begin{itemize}
    \item 14.9GB in 45 minutes (5.6MBps, 300k links/hour)
    \item $\approx$ 588 million words after cleaning
\end{itemize} 
}
% I Server [13-07-20 20:33:27] *** Closing sample <Sample 0, 228287/228287 [closed, complete]>
% I Server [13-07-20 20:33:27] Sample duration: 2717s, size: 14977.11MB

% 423055



\frame{\frametitle{Throughput (real-world)}
    \includegraphics[width=\textwidth]{realrate400}
}

%  XXX : Possibly include me if you need another slide
% \frame{\frametitle{Throughput (real-world)}
%     \includegraphics[width=\textwidth]{realrateboth}
% }

\frame{\frametitle{Download Times (Corpora)}
Using my 3-client deployment:
    \vspace{10pt}
\begin{itemize}
    \item BE06: a few seconds
    \vspace{10pt}
    \item BNC: 8 minutes
    \vspace{10pt}
    \item ukWaC: 2.5 hours (or 17 hours before filtering)
        % n of tokens 1,914,150,197
        % URLs: 6,528 
        % raw crawl size: 351 GB
        % n of documents after filtering: 5.69 M
    \vspace{10pt}
        \item DECOW2012: 12 hours (words); 24 hours (documents)
            % 9 billion words
            % 7.63 million documents
\end{itemize} 
}





% 
% \frame{\frametitle{Performance}
% % TODO
% \begin{itemize}
%     \item 
% \end{itemize}
% }



\subsection{Resources/Scalability}
\frame{\frametitle{Resources/Scalability}
    \begin{itemize}
        \item Memory usage $O(1)$ for client and server
        \vspace{5pt}
        \item Memory usage defined by batch size:
            \begin{itemize}
                \item Server: $(\textit{clients} \times \textit{batch\_size} \times \textit{link\_size}) + (\textit{batch\_size} \times \textit{max\_resource\_size})$
                \item Client: $\textit{in\_progress} \times \textit{max\_resource\_size}$ (using disk cache)
            \end{itemize}
        \vspace{5pt}
        \item Disk usage $O(N)$ for server, $O(1)$ for client.

        \vspace{5pt}
        \item Practically around 120-200MB for the application, 1-200MB for data.
    \end{itemize}

    \note{\begin{itemize}
            \item Practically server is about 200MB, with ruby and dep libraries in RAM
            \item The client is usually a bit less, around 120MB, but can grow if configured to do so.
            \item Payload sizes: server: client+about 10MB, client: usually up to 200MB or so
    \end{itemize}}

}


% -----------------------------------------------------------------------------------------
%  A rough overview of use
%  possibly a demo?
% \section{<Something>}

% 
% \frame{\frametitle{Use Cases}
% \begin{itemize}
%     \item 
%     \item 
%     \item 
%     \item 
%     \item 
% \end{itemize}  
%
% \note{\begin{itemize}
% \item
% \end{itemize}}
% }
% 



% -----------------------------------------------------------------------------------------
%  Summary/Marketing plug
\section{Summary}

\frame{\frametitle{Etiquette}
    \begin{itemize}
        \item LWAC is capable of DDOS-style throughput
        \vspace{5pt}
        \item Normally lists of links contain references to each server a few times
            %(their frequency is usually proportional to the popularity of the website, which means bigger sites can handle the traffic anyway)
        \vspace{5pt}
        \item Within-sample rate controlled by the parallel connection limit
        \vspace{5pt}
        \item Between-sample rate defined by sample period
    \end{itemize}    

    % \note{\begin{itemize}
    %         \item Not NETiquette.  God I hate that term.
    %         \item Parallelism is a more helpful way to limit hits to servers
    %         \item It's a bad idea for the quality of data to slow down each sample
    %         \item Nothing can be done about between-sample time, it's defined by your experimental design
    % \end{itemize}}

}






\frame{\frametitle{Summary}
\begin{itemize}
    \item LWAC makes longitudinal sampling easy (ish!)
        \vspace{5pt}
    \item Records many more variables than most download systems
        \vspace{5pt}
    \item Modest resource requirements
        \vspace{5pt}
    \item Fast and scalable
        \vspace{5pt}
    \item Fully documented, open source
\end{itemize} 

% 
% \note{\begin{itemize}
%     \item 
% \end{itemize}}
}


\frame{\frametitle{The Last Slide}

    \begin{center}

    \url{http://ucrel.lancs.ac.uk/LWAC/}\\
    \vspace{25pt}
    Demo during tea break\\
    \vspace{25pt}
    Suggestions/comments/bug reports welcome!\\
    \texttt{s.wattam@lancaster.ac.uk}

\end{center}
% 
% \note{\begin{itemize}
%     \item 
% \end{itemize}}
}

% -----------------------------------------------------------------------------------------
%  Auxiliary slides

% \frame{\frametitle{About}
% \begin{itemize}
%     \item 
% \end{itemize}    
% }

% -----------------------------------------------------------------------------------------
\end{document}
